<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Counter dApp</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>

<body class="bg-light">

  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6">

        <div class="card shadow-sm">
          <div class="card-body text-center">

            <h1 class="card-title mb-4">Counter dApp</h1>

            <button id="connect" class="btn btn-primary mb-3">
              Conectar Carteira
            </button>

            <p id="account" class="text-muted small"></p>

            <h2 class="my-4">
              Counter:
              <span id="counter" class="badge bg-secondary">-</span>
            </h2>

            <button id="increment" class="btn btn-success" disabled>
              Incrementar
            </button>

          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Ethers v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>

  <script>
    // ðŸ”´ ENDEREÃ‡O DO CONTRATO (Hardhat / Anvil padrÃ£o)
    const contractAddress = "0x5FbDB2315678afecb367f032d93F642f64180aa3";

    // âœ… ABI CORRETO PARA Counter.sol PADRÃƒO
    const contractABI = [
      "function counter() view returns (uint256)",
      "function increment()"
    ];

    let provider;
    let signer;
    let contract;

    const connectBtn = document.getElementById("connect");
    const incrementBtn = document.getElementById("increment");
    const counterSpan = document.getElementById("counter");
    const accountP = document.getElementById("account");

    connectBtn.onclick = async () => {
      try {
        if (!window.ethereum) {
          alert("MetaMask nÃ£o encontrada");
          return;
        }

        provider = new ethers.BrowserProvider(window.ethereum);

        // Solicita conexÃ£o
        await provider.send("eth_requestAccounts", []);

        signer = await provider.getSigner();
        const address = await signer.getAddress();

        accountP.innerText = `Conectado: ${address}`;

        contract = new ethers.Contract(
          contractAddress,
          contractABI,
          signer
        );

        incrementBtn.disabled = false;

        await loadCounter();
      } catch (err) {
        console.error("Erro ao conectar:", err);
      }
    };

    async function loadCounter() {
      try {
        const value = await contract.counter();
        counterSpan.innerText = value.toString();
      } catch (err) {
        console.error("Erro ao carregar counter:", err);
        counterSpan.innerText = "erro";
      }
    }

    incrementBtn.onclick = async () => {
      try {
        if (!contract) return;

        incrementBtn.disabled = true;

        const tx = await contract.increment();
        await tx.wait();

        await loadCounter();
      } catch (err) {
        console.error("Erro ao incrementar:", err);
      } finally {
        incrementBtn.disabled = false;
      }
    };
  </script>

</body>
</html>

